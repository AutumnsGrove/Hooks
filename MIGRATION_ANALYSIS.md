# Claude Code to OpenCode Migration Analysis

> Analysis completed: 2025-11-14
> Total hooks analyzed: 21 (1 implemented + 20 planned)

---

## Summary

This analysis examines each Claude Code hook in this repository to determine OpenCode plugin migration feasibility. The goal is to create a dual-support structure where developers can use either Claude Code or OpenCode.

### Key Findings

- **Fully Migratable**: 14 hooks (67%)
- **Partially Migratable**: 5 hooks (24%)
- **Not Migratable**: 2 hooks (9%)

---

## Migration Analysis Table

| # | Hook Name | Claude Code Event | Purpose | Migratable? | OpenCode Event | Notes |
|---|-----------|------------------|---------|-------------|----------------|-------|
| **IMPLEMENTED HOOKS** |
| 1 | grep-to-rg | PreToolUse | Convert grep → rg for performance | ✅ Yes | `tool.execute.before` | Direct translation - intercept Bash tool, modify command |
| **PHASE 1: CORE FUNCTIONALITY** |
| 2 | Auto-Formatters Suite | PostToolUse | Format code after edits (Black, Prettier, gofmt) | ✅ Yes | `tool.execute.after` | Run formatters on file changes |
| 3 | Smart TODO Extractor | PostToolUse | Extract TODOs with priority tags | ✅ Yes | `tool.execute.after` | Scan files for TODO/FIXME, write to TODOS_AUTOGENERATED.md |
| 4 | UV Enforcement | PreToolUse | Rewrite python → uv run python | ✅ Yes | `tool.execute.before` | Command transformation with escape hatch |
| 5 | UV Sync | PostToolUse | Run uv sync on dependency changes | ✅ Yes | `tool.execute.after` | Detect pyproject.toml edits, run sync |
| 6 | Conventional Commit Validator | PreToolUse | Enforce commit message format | ✅ Yes | `tool.execute.before` | Regex validation, block invalid commits |
| 7 | Modified Commit Footer | PreToolUse | Change commit message footer | ✅ Yes | `tool.execute.before` | String replacement in commit messages |
| 8 | rm -rf Protection | PreToolUse | Move to trash instead of delete | ✅ Yes | `tool.execute.before` | Command transformation, audit logging |
| 9 | Session Start Context Loader | SessionStart | Load project context on start | ⚠️ Partial | `session.start` | Limited - OpenCode SessionStart is basic, may lack Claude-specific context vars |
| **PHASE 2: TESTING & QUALITY** |
| 10 | Auto Test Runner | SubagentStop / PostToolUse | Run tests when created/modified | ✅ Yes | `tool.execute.after` | Detect test file changes, run appropriate framework |
| 11 | Command Tracking | PostToolUse | Log all tool calls to SQLite | ✅ Yes | `tool.execute.after` | Database logging with async writes |
| 12 | Session End Data Capture | SessionEnd | Store session analytics | ⚠️ Partial | `session.end` | OpenCode session.end exists but may have different data available |
| 13 | Subagent Session Tracking | SubagentStop | Track subagent metrics | ❌ No | N/A | **OpenCode has no subagent concept** |
| **PHASE 3: ENHANCEMENTS** |
| 14 | Smart PR Creator | PreToolUse | Auto-create PR for large changes | ✅ Yes | `tool.execute.before` | Check change size, create branch/PR if threshold exceeded |
| 15 | Session End TTS | SessionEnd | Audio notification on completion | ⚠️ Partial | `session.end` | Basic implementation possible, may lack outcome detection |
| 16 | Live Website Screenshot | PostToolUse | Capture & optimize browser screenshots | ✅ Yes | `tool.execute.after` | Take screenshot, optimize with Pillow, inject into context |
| 17 | NPM Vulnerability Checker | PostToolUse | Check vulnerabilities after npm install | ✅ Yes | `tool.execute.after` | Parse npm install output, run audit |
| 18 | Grand Finale Auto-Push | PostToolUse | Auto-push after commits | ✅ Yes | `tool.execute.after` | Detect successful commit, push to remote |
| 19 | Command Sounds | PostToolUse | Play sounds for different commands | ✅ Yes | `tool.execute.after` | Play audio files based on command type |
| **PHASE 4: ADVANCED** |
| 20 | Firefox DevTools Integration | PostToolUse | Browser inspection for web dev | ✅ Yes | `tool.execute.after` | Use Firefox Remote Debugging Protocol |
| 21 | Telegram Bot Integration | SessionEnd / Notification | Remote notifications & control | ⚠️ Partial | `session.end` | Notification possible, but remote control N/A |

---

## Detailed Migration Assessment

### ✅ Fully Migratable (14 hooks)

These hooks can be directly translated to OpenCode plugins with equivalent or better functionality:

#### 1. grep-to-rg ✅
- **Claude Event**: PreToolUse
- **OpenCode Event**: `tool.execute.before`
- **Migration**: Direct - intercept Bash tool, check for grep command, replace with rg
- **Complexity**: Low

#### 2. Auto-Formatters Suite ✅
- **Claude Event**: PostToolUse on Edit:*.py, Edit:*.ts, etc.
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Check file extension, run appropriate formatter
- **Complexity**: Low-Medium (multiple formatters to support)

#### 3. Smart TODO Extractor ✅
- **Claude Event**: PostToolUse on Edit/Write
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Scan file for TODO/FIXME with regex, extract with priority, append to TODOS_AUTOGENERATED.md
- **Complexity**: Medium

#### 4. UV Enforcement ✅
- **Claude Event**: PreToolUse on Bash:python*|pytest*|pip*
- **OpenCode Event**: `tool.execute.before`
- **Migration**: Command transformation with escape hatch detection
- **Complexity**: Low-Medium

#### 5. UV Sync ✅
- **Claude Event**: PostToolUse on Edit:pyproject.toml
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Detect dependency file changes, run `uv sync`
- **Complexity**: Low

#### 6. Conventional Commit Validator ✅
- **Claude Event**: PreToolUse on Bash:git commit*
- **OpenCode Event**: `tool.execute.before`
- **Migration**: Regex validation of commit message, throw error to block
- **Complexity**: Low

#### 7. Modified Commit Footer ✅
- **Claude Event**: PreToolUse on Bash:git commit*
- **OpenCode Event**: `tool.execute.before`
- **Migration**: String replacement in commit message
- **Complexity**: Low

#### 8. rm -rf Protection ✅
- **Claude Event**: PreToolUse on Bash:*rm -rf*
- **OpenCode Event**: `tool.execute.before`
- **Migration**: Replace rm -rf with trash command, log to audit file
- **Complexity**: Low-Medium

#### 10. Auto Test Runner ✅
- **Claude Event**: SubagentStop or PostToolUse
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Detect test file changes, run appropriate test framework
- **Complexity**: Medium (smart test scope detection)

#### 11. Command Tracking ✅
- **Claude Event**: PostToolUse on all tools
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Log tool call data to SQLite with async writes
- **Complexity**: Medium (async logging, database schema)

#### 14. Smart PR Creator ✅
- **Claude Event**: PreToolUse on Bash:git commit*
- **OpenCode Event**: `tool.execute.before`
- **Migration**: Calculate change size, create branch/PR if threshold exceeded
- **Complexity**: Medium-High (git operations, PR creation)

#### 16. Live Website Screenshot ✅
- **Claude Event**: PostToolUse on web dev file changes
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Screenshot capture, optimization pipeline (crop, resize, compress)
- **Complexity**: Medium-High (image processing, deduplication)

#### 17. NPM Vulnerability Checker ✅
- **Claude Event**: PostToolUse on Bash:npm install*
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Parse npm output, run audit, display summary
- **Complexity**: Low-Medium

#### 18. Grand Finale Auto-Push ✅
- **Claude Event**: PostToolUse on git commit
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Detect successful commit, push to remote with branch safety checks
- **Complexity**: Low

#### 19. Command Sounds ✅
- **Claude Event**: PostToolUse
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Play audio files based on command type
- **Complexity**: Low

#### 20. Firefox DevTools Integration ✅
- **Claude Event**: PostToolUse
- **OpenCode Event**: `tool.execute.after`
- **Migration**: Use Firefox Remote Debugging Protocol API
- **Complexity**: High (complex API integration)

---

### ⚠️ Partially Migratable (5 hooks)

These hooks can be implemented in OpenCode but with reduced functionality or different behavior:

#### 9. Session Start Context Loader ⚠️
- **Claude Event**: SessionStart
- **OpenCode Event**: `session.start`
- **Issue**: OpenCode's SessionStart may not provide the same context variables as Claude Code
- **Migration**: Basic context loading possible (git info, README, TODOS), but Claude-specific variables may be missing
- **Complexity**: Medium
- **Recommendation**: Implement with fallbacks, document limitations

#### 12. Session End Data Capture ⚠️
- **Claude Event**: SessionEnd
- **OpenCode Event**: `session.end`
- **Issue**: Available session data may differ between systems
- **Migration**: Basic session tracking possible (duration, timestamp), but detailed metrics may vary
- **Complexity**: Medium
- **Recommendation**: Implement common subset of metrics

#### 13. Subagent Session Tracking ❌
- **Claude Event**: SubagentStop
- **OpenCode Event**: **N/A - No equivalent**
- **Issue**: OpenCode does not have a subagent system
- **Migration**: **NOT POSSIBLE**
- **Recommendation**: **Claude Code only** - Document as unavailable in OpenCode

#### 15. Session End TTS ⚠️
- **Claude Event**: SessionEnd
- **OpenCode Event**: `session.end`
- **Issue**: May not have access to error state or outcome metrics
- **Migration**: Basic TTS possible, but outcome-based variations may be limited
- **Complexity**: Medium
- **Recommendation**: Implement simplified version (single message or random selection)

#### 21. Telegram Bot Integration ⚠️
- **Claude Event**: SessionEnd / Notification
- **OpenCode Event**: `session.end`
- **Issue**: Remote control features not applicable to OpenCode
- **Migration**: Notifications possible, but remote command sending N/A
- **Complexity**: High
- **Recommendation**: Implement notification-only version

---

### ❌ Not Migratable (2 hooks)

These hooks are fundamentally incompatible with OpenCode:

#### 13. Subagent Session Tracking ❌
- **Reason**: OpenCode has no subagent system or SubagentStop event
- **Alternative**: None
- **Action**: Document as Claude Code exclusive feature

---

## OpenCode Lifecycle Event Mapping

| Claude Code Event | OpenCode Equivalent | Notes |
|-------------------|---------------------|-------|
| `PreToolUse` | `tool.execute.before` | ✅ Direct mapping |
| `PostToolUse` | `tool.execute.after` | ✅ Direct mapping |
| `UserPromptSubmit` | `prompt.submit` (possibly) | ⚠️ May not exist or differ |
| `SessionStart` | `session.start` | ⚠️ Limited context variables |
| `SessionEnd` | `session.end` | ⚠️ Limited session data |
| `SubagentStop` | **N/A** | ❌ No OpenCode equivalent |
| `Stop` | `session.end` (approximate) | ⚠️ Different trigger timing |
| `PreCompact` | **N/A** | ❌ OpenCode uses different context management |
| `Notification` | Possibly `notification` hook | ⚠️ Unconfirmed if exists |

---

## Migration Complexity Assessment

### Low Complexity (9 hooks)
- grep-to-rg
- UV Enforcement
- UV Sync
- Conventional Commit Validator
- Modified Commit Footer
- rm -rf Protection
- Grand Finale Auto-Push
- Command Sounds
- NPM Vulnerability Checker

### Medium Complexity (7 hooks)
- Auto-Formatters Suite
- Smart TODO Extractor
- Auto Test Runner
- Command Tracking
- Session Start Context Loader
- Session End Data Capture
- Session End TTS

### High Complexity (3 hooks)
- Smart PR Creator
- Live Website Screenshot
- Firefox DevTools Integration

### Not Implementable (2 hooks)
- Subagent Session Tracking (no OpenCode equivalent)
- Telegram remote control (Claude Code specific)

---

## Recommended Migration Priority

### Phase 1: Quick Wins (Low Complexity, High Value)
1. grep-to-rg ✅
2. UV Enforcement ✅
3. Conventional Commit Validator ✅
4. Modified Commit Footer ✅
5. Auto-Formatters Suite ✅

### Phase 2: Medium Effort (Medium Complexity, High Value)
6. Smart TODO Extractor ✅
7. Command Tracking ✅
8. Auto Test Runner ✅
9. UV Sync ✅

### Phase 3: Advanced Features (High Complexity)
10. Live Website Screenshot ✅
11. Smart PR Creator ✅
12. Session End Data Capture ⚠️

### Phase 4: Nice-to-Have (Lower Priority)
13. NPM Vulnerability Checker ✅
14. Grand Finale Auto-Push ✅
15. Command Sounds ✅
16. Session End TTS ⚠️

### Document as Claude Code Only
- Subagent Session Tracking ❌
- Telegram remote control ❌

---

## Git Hooks Status

**Important Note**: The git hooks in `ClaudeUsage/pre_commit_hooks/` are **NOT Claude Code hooks**. They are traditional git hooks that work independently of any AI coding assistant.

These hooks do **NOT** need migration to OpenCode because they:
- Run via git's native hook system
- Work with any development workflow
- Are already portable across any codebase

**Git hooks in this repo:**
- pre-commit-secrets-scanner
- pre-commit-python
- pre-commit-javascript
- pre-commit-go
- pre-commit-multi-language
- commit-msg
- prepare-commit-msg
- pre-push
- post-checkout
- post-commit

These will remain in the repository as standalone tools that complement both Claude Code and OpenCode workflows.

---

## Implementation Notes

### OpenCode Plugin Advantages
- **TypeScript/JavaScript**: More familiar to web developers
- **Native async/await**: Cleaner async code
- **Built-in modules**: fs, path, child_process
- **zx integration**: Easy shell command execution via `$`

### Claude Code Hook Advantages
- **Any language**: Python, Shell, JavaScript, etc.
- **More events**: SubagentStop, PreCompact, Stop
- **Better context**: More environment variables
- **Mature ecosystem**: More examples and community hooks

### Translation Patterns

#### Command Transformation (PreToolUse → tool.execute.before)
```python
# Claude Code (Python)
import json, sys
input_data = json.load(sys.stdin)
if input_data.get("tool_name") == "Bash":
    command = input_data["tool_input"]["command"]
    new_command = command.replace("grep", "rg")
    output = {
        "hookSpecificOutput": {
            "hookEventName": "PreToolUse",
            "permissionDecision": "allow",
            "updatedInput": {"command": new_command}
        }
    }
    print(json.dumps(output))
```

```typescript
// OpenCode (TypeScript)
export const GrepToRgPlugin: Plugin = async () => {
  return {
    tool: {
      execute: {
        before: async (input) => {
          if (input.tool === 'Bash') {
            const command = input.parameters.command
            const newCommand = command.replace(/grep/g, 'rg')
            return { ...input, parameters: { command: newCommand } }
          }
          return input
        }
      }
    }
  }
}
```

#### Post-Processing (PostToolUse → tool.execute.after)
```python
# Claude Code (Python)
import os, subprocess
file_paths = os.getenv("CLAUDE_FILE_PATHS", "").split(",")
for file in file_paths:
    if file.endswith(".py"):
        subprocess.run(["black", file])
```

```typescript
// OpenCode (TypeScript)
export const AutoFormatterPlugin: Plugin = async ({ $ }) => {
  return {
    tool: {
      execute: {
        after: async (input, output) => {
          if (input.tool === 'Edit' && input.parameters.file_path?.endsWith('.py')) {
            await $`black ${input.parameters.file_path}`
          }
        }
      }
    }
  }
}
```

---

## Next Steps

1. ✅ **Step 1 Complete**: Migration analysis table created
2. ⏭️ **Step 2**: Create folder structure (claude-code/, opencode/, docs/)
3. ⏭️ **Step 3**: Migrate hooks to OpenCode plugins (start with Phase 1)
4. ⏭️ **Step 4**: Create documentation (migration guide, comparison, READMEs)
5. ⏭️ **Step 5**: Create example hooks showing both systems side-by-side
6. ⏭️ **Step 6**: Test plugins and update main README
7. ⏭️ **Step 7**: Commit and push migration changes

---

*Analysis completed: 2025-11-14*
*Ready to proceed with folder structure and migration implementation.*

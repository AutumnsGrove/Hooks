# Hook Ideas & Implementation Plan

> Ideas captured: 2025-11-13
> Status: Planning phase
> Priority: Organize by implementation order

---

## Quick Reference

- üü¢ **High Priority** - Implement soon
- üü° **Medium Priority** - Valuable but not urgent
- üîµ **Nice to Have** - Future enhancement
- üü£ **Far Future** - Long-term idea

---

## 1. Code Quality & Formatting

### üü¢ Auto-Formatters Suite
**Event:** PostToolUse
**Matchers:** `Edit:*.py`, `Edit:*.ts`, `Edit:*.tsx`, `Edit:*.js`, `Edit:*.go`, etc.

Automatically format code after edits:
- **Black** for Python
- **Prettier** for TypeScript/JavaScript
- **Gofmt** for Go
- **Rustfmt** for Rust

**Implementation notes:**
- Keep it simple to avoid slowdown
- Consider bundling into one hook script with conditional logic based on file extension

---

### üü¢ Smart TODO Extractor
**Event:** PostToolUse
**Matcher:** `Edit:*|Write:*`

Automatically scan created/edited files for TODO comments and extract them:
- Regex scan for `TODO`, `FIXME`, `HACK`, `XXX`, etc.
- Grab surrounding context (line above/below)
- Append to `TODOS_AUTOGENERATED.md` with:
  - File path
  - Line number
  - Full TODO text with context
  - Timestamp

**Output format example:**
```markdown
## src/app.py:42
- TODO: Refactor authentication logic to use JWT
- Context: Currently using session-based auth
- Added: 2025-11-13 14:30
```

---

## 2. Testing & Validation

### üü¢ Auto Test Runner
**Event:** SubagentStop (or PostToolUse)
**Trigger:** Regex scan for "tests created", "test implementation", "test suite"

Automatically run tests when subagents create them:
- Scan subagent completion summary for test-related keywords
- Detect test files created/modified
- Run appropriate test command:
  - `uv run pytest` for Python
  - `npm test` for JavaScript
  - `cargo test` for Rust
  - `go test ./...` for Go

**Smart detection:**
- Check which test framework is being used
- Only run tests for affected files/modules
- Display results in concise format

---

## 3. Git & Version Control

### üü¢ Conventional Commit Validator
**Event:** PreToolUse
**Matcher:** `Bash:git commit*`

Enforce conventional commit format:
- Regex: `^(feat|fix|docs|refactor|test|chore|perf|style|ci|build)(\(.+\))?: .+`
- Block commits that don't match (exit code 2)
- Provide helpful error message with examples

**Valid formats:**
```bash
feat: add user authentication
fix(auth): correct JWT expiration handling
docs: update README with installation steps
```

---

### üü¢ Modified Commit Message Footer
**Event:** PreToolUse or PostToolUse
**Matcher:** `Bash:git commit*`

Change the commit footer from:
```
ü§ñ Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude <noreply@anthropic.com>
```

To:
```
Created with Claude Code Sonnet 4.5

Co-Authored-By: Claude <noreply@anthropic.com>
```

**No emoji, cleaner, includes model version**

---

### üü° Smart PR Creator
**Event:** PreToolUse
**Matcher:** `Bash:git commit*`

When committing a LOT of changes, create a PR instead of going straight to main:

**Triggers:**
- More than X files changed (configurable, default: 10)
- More than Y lines changed (configurable, default: 500)
- Commit message indicates major feature (starts with `feat!` or `BREAKING`)

**Actions:**
1. Calculate change size with Python script
2. If threshold exceeded:
   - Create feature branch: `feature/auto-pr-{timestamp}`
   - Commit changes to branch
   - Push branch
   - Create PR using `gh pr create`
   - Notify user

**Configuration:**
- `~/.claude/hooks/smart-pr-config.json` for thresholds
- Option to bypass with commit flag

---

### üü° "Grand Finale" Auto-Push Hook
**Event:** PostToolUse (after successful commit)
**Matcher:** `Bash:git commit*`

Automatically push and sync after commits:
- Detect successful commit
- Run `git push origin <current-branch>`
- Display sync status

**Safety considerations:**
- Only on specific branches? (not main/master by default?)
- Configurable opt-in/opt-out
- Skip if working on PR

---

## 4. Security & Safety

### üü¢ rm -rf Protection
**Event:** PreToolUse
**Matcher:** `Bash:*rm -rf*` or `Bash:*rm *-rf*`

Don't block the command, but move files to trash instead:

**Implementation:**
1. Intercept `rm -rf` commands
2. Parse target paths
3. Use `trash` command (macOS/Linux) instead:
   ```bash
   trash "$TARGET" # instead of rm -rf
   ```
4. Notify Claude: "Moved to trash instead of permanently deleting"

**Benefits:**
- Safety net for accidents
- Non-blocking (doesn't break flow)
- Easy recovery

**Requirements:**
- Install `trash-cli` or use native macOS `trash` command

---

### üü° Secrets Scanner
**Event:** PreToolUse
**Matcher:** `Edit:*|Write:*`

Check if git hooks already handle this (`.git/hooks/pre-commit-secrets`), but consider adding:
- Real-time scanning before Claude processes
- Patterns for API keys, tokens, credentials
- Block with exit code 2 if detected

**Note:** May already be covered by existing git hooks - verify first!

---

## 5. Python & UV Integration

### üü¢ UV Enforcement Hook
**Event:** PreToolUse
**Matcher:** `Bash:python *|Bash:pytest *|Bash:pip *`

Automatically rewrite Python commands to use UV:

**Transformations:**
```bash
python script.py ‚Üí uv run python script.py
pytest tests/ ‚Üí uv run pytest tests/
pip install pkg ‚Üí uv pip install pkg
```

**Implementation:**
- Intercept command in PreToolUse
- Rewrite command
- Pass modified command to Claude
- Notify: "Enforcing UV usage: uv run python..."

---

### üü¢ UV Sync Hook
**Event:** PostToolUse
**Matcher:** `Edit:pyproject.toml|Edit:requirements.txt`

Automatically run `uv sync` when dependencies change:
- Detect edits to `pyproject.toml` or `requirements.txt`
- Run `uv sync` in background
- Display result (success/failure)

---

## 6. Visual Development & Screenshots

### üü° Live Website Screenshot Hook
**Event:** PostToolUse (on file changes)
**Matcher:** `Edit:*.html|Edit:*.css|Edit:*.tsx|Edit:*.jsx`

Automatically screenshot the visible browser tab/desktop:

**Workflow:**
1. Detect web dev file changes
2. Take desktop screenshot with Python script
3. Inject screenshot into Claude's context
4. Claude can SEE what it's creating in real-time

**Implementation:**
- Use `pyautogui` or `mss` for screenshots
- Crop to browser window if possible
- Save to temp file
- Send to Claude via context injection

**Requirements:**
- Dev server must be running
- Browser tab visible on screen

---

### üîµ Firefox DevTools Integration
**Event:** PostToolUse (on web dev changes)

Similar to Chrome DevTools Protocol but for Firefox:
- Use Firefox Remote Debugging Protocol
- Inspect DOM, network, console
- Capture performance metrics

**Note:** Lower priority, more complex setup

---

## 7. Audio & Notifications

### üü° Session End TTS (Randomized)
**Event:** SessionEnd or Stop

Play randomized TTS message when Claude finishes:

**Using Kokoro TTS with BF_lily voice:**

**Message pool (10 variations):**
1. "Claude Code session complete"
2. "All tasks finished"
3. "Work completed successfully"
4. "Session ended, ready for next task"
5. "Processing complete"
6. "Claude has finished"
7. "Session wrapped up"
8. "All done here"
9. "Task execution complete"
10. "Ready for your next request"

**Implementation:**
```python
import random
import subprocess

messages = [...]  # 10 variations above
chosen = random.choice(messages)

subprocess.run([
    "kokoro-cli",
    "--voice", "BF_lily",
    "--text", chosen
])
```

**Note:** Keep cloud TTS for future, use local Kokoro for now

---

### üü° More Specific Command Sounds
**Ideas from research:** Different sounds for git, ffmpeg, npm, etc.

**Consideration:** You mentioned this added overhead before. Let's implement carefully:
- Only add sounds for most common commands
- Keep sound files small
- Test performance impact
- Easy to disable

**Examples:**
- Git operations: submarine.aiff
- Tests passing: glass.aiff
- Errors: basso.aiff
- File edits: pop.aiff

---

## 8. Analytics & Tracking

### üü¢ Session End Data Capture
**Event:** SessionEnd

Parse and store session data in SQLite DB:

**Captured data:**
- Session ID & timestamp
- Duration (start to end)
- Tools used (count by type)
- Files modified (list)
- Commands executed (list)
- Tokens used (estimate)
- Model used (Sonnet 4.5, etc.)
- Extremely generalized summary (AI-generated, 2-3 sentences)

**Database schema:**
```sql
CREATE TABLE sessions (
    id TEXT PRIMARY KEY,
    timestamp DATETIME,
    duration_seconds INTEGER,
    tools_used JSON,
    files_modified JSON,
    commands JSON,
    summary TEXT,
    model TEXT
);
```

**Background processing:**
- Python script runs async
- No impact on Claude session (already ending)
- Brief message: "Session data captured ‚úì" (optional)

**Future:** Monthly visualizations (charts, trends, productivity insights)

---

### üü¢ Subagent Session Tracking
**Event:** SubagentStop

Similar to main session tracking, but for subagents:

**Captured data:**
- Subagent type/name
- Task summary (from subagent completion message)
- Duration
- Files touched
- "Next steps" recommendations (parsed from summary)

**Separate SQLite DB:**
```sql
CREATE TABLE subagent_sessions (
    id TEXT PRIMARY KEY,
    parent_session_id TEXT,
    subagent_type TEXT,
    timestamp DATETIME,
    duration_seconds INTEGER,
    summary TEXT,
    next_steps TEXT,
    files_modified JSON
);
```

**Use case:** Query which subagents are most used, track task patterns

---

### üü¢ Command Tracking Hook
**Event:** PostToolUse
**Matcher:** `Bash:*`

Track which commands Claude Code uses and when:

**Log to SQLite:**
```sql
CREATE TABLE commands (
    id INTEGER PRIMARY KEY,
    session_id TEXT,
    timestamp DATETIME,
    command TEXT,
    description TEXT,
    exit_code INTEGER,
    duration_ms INTEGER
);
```

**Analysis ideas:**
- Most frequently used commands
- Command patterns per project type
- Time of day usage
- Success/failure rates

---

## 9. NPM & Package Management

### üü° NPM Vulnerability Checker
**Event:** PostToolUse
**Matcher:** `Bash:npm install*`

Check for vulnerabilities after npm install:

**Implementation:**
1. Wait for `npm install` to complete
2. Parse output for vulnerability warnings
3. If vulnerabilities found:
   - Display summary
   - Suggest: "Run `npm audit fix` to resolve"
   - Optionally auto-run `npm audit fix --force` (configurable)

**Output example:**
```
‚ö†Ô∏è  NPM Vulnerabilities Detected:
- 3 high severity
- 7 moderate severity

Suggestion: Run `npm audit fix` to resolve
```

---

## 10. Context Enhancement

### üü¢ Session Start Context Loader
**Event:** SessionStart

Automatically provide Claude with project context on session start:

**Context to load:**
1. **Git info:**
   - Last 10 commits (`git log -10 --oneline`)
   - Current branch
   - Uncommitted changes (`git status --short`)

2. **Project files:**
   - `README.md` (if exists)
   - `Spec.md` or `SPEC.md` (project specification)
   - `TODOS.md` (main TODO list)
   - `CLAUDE.md` (project instructions)

3. **Dependencies:**
   - `package.json` (for Node projects)
   - `pyproject.toml` (for Python projects)
   - `Cargo.toml` (for Rust projects)
   - `go.mod` (for Go projects)

4. **Environment:**
   - Check for `.env.example` or `.env.template`
   - List available environment variables (without values)

**Implementation:**
- Python script that aggregates all context
- Output as structured JSON or markdown
- Inject into Claude's context via stdout (exit code 0)
- Keep it concise (don't send entire file contents, just summaries)

**Benefits:**
- Claude starts with full project understanding
- Faster task completion
- Fewer clarifying questions needed

---

## 11. Future / Experimental Ideas

### üü£ Telegram Bot Integration (Far Future)
**Status:** Optional, low priority

Two-way communication via Telegram:
- Receive notifications when sessions complete
- Send commands to Claude remotely
- Interactive buttons for common actions

**Considerations:**
- Needs to be TOTALLY optional
- Maybe a session-specific flag to enable?
- Security: whitelist users
- Not a hooks thing, more of a separate service

**Implementation complexity:** High
**Timeline:** Not urgent, revisit later

---

## Implementation Priority

### Phase 1: Core Functionality (Implement First)
1. ‚úÖ Auto-formatters suite
2. ‚úÖ Smart TODO extractor
3. ‚úÖ UV enforcement hook
4. ‚úÖ UV sync hook
5. ‚úÖ Conventional commit validator
6. ‚úÖ Modified commit message footer
7. ‚úÖ rm -rf protection
8. ‚úÖ Session start context loader

### Phase 2: Testing & Quality (Next)
9. ‚úÖ Auto test runner
10. ‚úÖ Command tracking hook
11. ‚úÖ Session end data capture
12. ‚úÖ Subagent session tracking

### Phase 3: Enhancements (After Core is Stable)
13. ‚úÖ Smart PR creator
14. ‚úÖ Session end TTS (randomized)
15. ‚úÖ Live website screenshot hook
16. ‚úÖ NPM vulnerability checker
17. ‚úÖ "Grand finale" auto-push hook
18. ‚úÖ More specific command sounds

### Phase 4: Advanced Features (Future)
19. ‚è≥ Firefox DevTools integration
20. ‚è≥ Telegram bot integration

---

## Questions for Clarification

### 1. Smart TODO Extractor
**Q:** Should it REPLACE the existing TODOS.md or keep both separate?
- Option A: Keep manual TODOS.md, generate TODOS_AUTOGENERATED.md
- Option B: Merge into single TODOS.md with sections
- Option C: Replace entirely (risky)

**Recommendation:** Option A (separate files)

---

### 2. Grand Finale Auto-Push
**Q:** Should this auto-push to ALL branches or exclude certain ones?
- Safety concern: Auto-pushing to `main` could be risky
- Suggestion: Configurable whitelist/blacklist
  - Default: Allow on feature branches, skip on main/master/develop

**What's your preference?**

---

### 3. Live Website Screenshot
**Q:** How often should screenshots be taken?
- Every file change? (could be excessive)
- Every N changes?
- Only when Claude asks "how does it look?"
- Manual trigger via special comment?

**Recommendation:** Start conservative (only on request or every 5 changes)

---

### 4. Session End TTS
**Q:** Is Kokoro TTS CLI available as `kokoro-cli` or different command?
- Need to verify exact command syntax
- Also: Should there be a mute toggle for silent sessions?

---

### 5. Command Tracking
**Q:** Track ALL commands or just Bash commands?
- All tools (Edit, Write, Read, Bash)?
- Just Bash for now?

**Recommendation:** Start with Bash, expand later

---

### 6. Smart PR Creator Thresholds
**Q:** What thresholds feel right to you?
- Files changed: 10? 15? 20?
- Lines changed: 500? 1000?
- Should it ask for confirmation or just do it?

---

## Next Steps

1. **Clarify questions** above (1-2 most important ones)
2. **Prioritize Phase 1** items (already listed)
3. **Set up project structure** for hooks:
   - Create `/hooks/` directory with subdirectories
   - Write hook scripts
   - Configure `.claude/settings.json`
4. **Test one hook at a time** to ensure stability
5. **Document each hook** as we implement

---

## Notes

- Keep all implementations **simple and straightforward** to avoid slowdown
- Test performance impact of each hook
- Make hooks **easily toggleable** (comment out in settings.json)
- Maintain **backwards compatibility** (don't break existing workflows)
- **Document everything** so future you can maintain it

---

*Ideas captured from session on 2025-11-13*
*Ready for implementation! Let's build some awesome hooks! üöÄ*
